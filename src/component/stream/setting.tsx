import { useState, useEffect, } from 'react';
import { useRouter } from 'next/navigation';

import styles from '@/styles/stream/setting.module.css';

interface Refs {
    videoRef: React.RefObject<HTMLVideoElement>;
    streamRef: React.MutableRefObject<MediaStream | null>;
}

interface ScreenProps {
    isCurrentScreenOff: boolean;
    onShareMyCurrentScreen: () => Promise<void>
    refs: Refs;
}

function Setting({ isCurrentScreenOff, onShareMyCurrentScreen, refs }: ScreenProps) {

    const { streamRef } = refs;

    // screen resize
    const [browserWidth, setBrowserWidth] = useState<number>();

    // option on/off
    const [isMicOn, setIsMicOn] = useState<boolean>(true);
    const [isVideoOn, setIsVideoOn] = useState<boolean>(true);
    const [isScreenRecordingOff, setIsScreenRecordingOff] = useState<boolean>(true);

    // browser width - 1024px 
    const oneThousandTwentyFourWidth = 1024;

    // router
    const router = useRouter();

    // toggle mic
    const onToggleMic = () => {
        if (streamRef.current) {
            const audioTracks = streamRef.current.getAudioTracks();
            audioTracks.forEach(track => {
                track.enabled = !track.enabled;
            });
            setIsMicOn(prevState => !prevState);
        }
    };

    // toggle video
    const onToggleVideo = () => {
        if (streamRef.current) {
            const videoTracks = streamRef.current.getVideoTracks();
            videoTracks.forEach(track => {
                track.enabled = !track.enabled;
            });
            setIsVideoOn(prevState => !prevState);
        }
    };

    // record screen 
    const onRecordScreen = () => {
        setIsScreenRecordingOff(prevState => !prevState);
    }

    // disconnect streaming and go back to main page
    const onDisconnect = () => {
        router.push('/');
    }

    // screen size initial value
    useEffect(() => {
        setBrowserWidth(window.innerWidth);
    }, []);

    // observe screen resizing
    useEffect(() => {
        const handleResize = () => {
            setBrowserWidth(window.innerWidth);
        };

        window.addEventListener('resize', handleResize);

        return () => {
            window.removeEventListener('resize', handleResize);
        };
    }, []);

    if (!browserWidth) return;

    return (
        <section className={styles['container']}>
            <div className={styles['wrapper']}>
                {/* setting bar */}
                <div className={styles['setting-bar']}>
                    {/* left setting bar */}
                    <div className={styles['left-setting-bar']}>
                        <h2>10 : 28 오전 </h2>
                        <span>|</span>
                        <p>adw-tor-knsm</p>
                    </div>
                    {/* middle setting bar */}
                    <div className={styles['middle-setting-bar']}>
                        {/* mic button */}
                        {
                            isMicOn
                                ?
                                <div className={styles['svg-box']} onClick={onToggleMic}>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                                        <g strokeWidth="0" />
                                        <g strokeLinecap="round" strokeLinejoin="round" />
                                        <g>
                                            <path d="M8 5C8 2.79086 9.79086 1 12 1C14.2091 1 16 2.79086 16 5V12C16 14.2091 14.2091 16 12 16C9.79086 16 8 14.2091 8 12V5Z" fill="#000000" /> <path d="M6.25 11.8438V12C6.25 13.525 6.8558 14.9875 7.93414 16.0659C9.01247 17.1442 10.475 17.75 12 17.75C13.525 17.75 14.9875 17.1442 16.0659 16.0659C17.1442 14.9875 17.75 13.525 17.75 12V11.8438C17.75 11.2915 18.1977 10.8438 18.75 10.8438H19.25C19.8023 10.8438 20.25 11.2915 20.25 11.8437V12C20.25 14.188 19.3808 16.2865 17.8336 17.8336C16.5842 19.0831 14.9753 19.8903 13.25 20.1548V22C13.25 22.5523 12.8023 23 12.25 23H11.75C11.1977 23 10.75 22.5523 10.75 22V20.1548C9.02471 19.8903 7.41579 19.0831 6.16637 17.8336C4.61919 16.2865 3.75 14.188 3.75 12V11.8438C3.75 11.2915 4.19772 10.8438 4.75 10.8438H5.25C5.80228 10.8438 6.25 11.2915 6.25 11.8438Z" fill="#000000" />
                                        </g>
                                    </svg>
                                </div>
                                :
                                <div className={styles['off-svg-box']} onClick={onToggleMic}>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                                        <path d="M12 1C13.6452 1 15.0585 1.99333 15.6728 3.41298L7.99997 11.0858V5C7.99997 2.79086 9.79083 1 12 1Z" fill="#ffffff" />
                                        <path d="M6.24997 12C6.24997 12.2632 6.26801 12.5245 6.30342 12.7823L4.25194 14.8338C3.92295 13.9344 3.74997 12.9761 3.74997 12V11.8438C3.74997 11.2915 4.19769 10.8438 4.74997 10.8438H5.24997C5.80226 10.8438 6.24997 11.2915 6.24997 11.8438V12Z" fill="#ffffff" />
                                        <path d="M7.3242 18.7971L3.76773 22.3535C3.3772 22.7441 2.74404 22.7441 2.35352 22.3535L1.64641 21.6464C1.25588 21.2559 1.25588 20.6227 1.64641 20.2322L20.2322 1.64644C20.6227 1.25591 21.2559 1.25591 21.6464 1.64644L22.3535 2.35354C22.744 2.74407 22.744 3.37723 22.3535 3.76776L16 10.1213V12C16 14.2091 14.2091 16 12 16C11.4457 16 10.9177 15.8873 10.4378 15.6835L9.13553 16.9857C9.99969 17.4822 10.986 17.75 12 17.75C13.525 17.75 14.9875 17.1442 16.0658 16.0659C17.1442 14.9875 17.75 13.525 17.75 12V11.8438C17.75 11.2915 18.1977 10.8438 18.75 10.8438H19.25C19.8023 10.8438 20.25 11.2915 20.25 11.8437V12C20.25 14.188 19.3808 16.2865 17.8336 17.8336C16.5842 19.0831 14.9753 19.8903 13.25 20.1548V23H10.75V20.1548C9.51944 19.9662 8.34812 19.5014 7.3242 18.7971Z" fill="#ffffff" />
                                    </svg>
                                </div>
                        }
                        {/* video button */}
                        {
                            isVideoOn
                                ?
                                <div className={styles['svg-box']} onClick={onToggleVideo}>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                                        <path fillRule="evenodd" clipRule="evenodd" d="M2 9C2 6.79086 3.79086 5 6 5H13C15.2091 5 17 6.79086 17 9V9.07171L20.202 7.23108C21.0019 6.77121 22 7.34868 22 8.27144V15.7488C22 16.6203 21.1003 17.2012 20.306 16.8424L16.9855 15.3425C16.8118 17.3913 15.0938 19 13 19H6C3.79086 19 2 17.2091 2 15V9ZM17 13.1544L20 14.5096V9.65407L17 11.3786V13.1544ZM15 9C15 7.89543 14.1046 7 13 7H6C4.89543 7 4 7.89543 4 9V15C4 16.1046 4.89543 17 6 17H13C14.1046 17 15 16.1046 15 15V9Z" fill="#000000" />
                                    </svg>
                                </div>
                                :
                                <div className={styles['off-svg-box']} onClick={onToggleVideo}>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                                        <path d="M20.7071 4.70711C21.0976 4.31658 21.0976 3.68342 20.7071 3.29289C20.3166 2.90237 19.6834 2.90237 19.2929 3.29289L3.29289 19.2929C2.90237 19.6834 2.90237 20.3166 3.29289 20.7071C3.68342 21.0976 4.31658 21.0976 4.70711 20.7071L20.7071 4.70711Z" fill="#ffffff" />
                                        <path d="M13 5C13.8933 5 14.7181 5.29281 15.3839 5.78768L13.9383 7.2333C13.6585 7.08438 13.3391 7 13 7H6C4.89543 7 4 7.89543 4 9V15C4 15.5959 4.26065 16.131 4.67416 16.4974L3.25865 17.9129C2.48379 17.1834 2 16.1482 2 15V9C2 6.79086 3.79086 5 6 5H13Z" fill="#ffffff" />
                                        <path fillRule="evenodd" clipRule="evenodd" d="M13 17H9.82843L7.82843 19H13C15.0938 19 16.8118 17.3913 16.9855 15.3425L20.306 16.8424C21.1003 17.2012 22 16.6203 22 15.7488V8.27144C22 7.34868 21.0019 6.77121 20.202 7.23108L18.7799 8.04856L15 11.8284V15C15 16.1046 14.1046 17 13 17ZM17 13.1544L20 14.5096V9.65407L17 11.3786V13.1544Z" fill="#ffffff" />
                                    </svg>
                                </div>
                        }
                        {/* screen record button */}
                        {
                            isScreenRecordingOff
                                ?
                                <div className={styles['svg-box']} onClick={onRecordScreen}>
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="#000000" width="24" height="24" viewBox="0 0 1920 1920">
                                        <path d="M960 0c529.36 0 960 430.645 960 960 0 529.36-430.64 960-960 960-529.355 0-960-430.64-960-960C0 430.645 430.645 0 960 0Zm0 112.941c-467.125 0-847.059 379.934-847.059 847.059 0 467.12 379.934 847.06 847.059 847.06 467.12 0 847.06-379.94 847.06-847.06 0-467.125-379.94-847.059-847.06-847.059Zm0 313.726c294.55 0 533.33 238.781 533.33 533.333 0 294.55-238.78 533.33-533.33 533.33-294.552 0-533.333-238.78-533.333-533.33 0-294.552 238.781-533.333 533.333-533.333Z" fillRule="evenodd" />
                                    </svg>
                                </div>
                                :
                                <div className={styles['screen-record-svg-box']} onClick={onRecordScreen}>
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="#ffffff" width="24" height="24" viewBox="0 0 1920 1920">
                                        <path d="M960 0c529.36 0 960 430.645 960 960 0 529.36-430.64 960-960 960-529.355 0-960-430.64-960-960C0 430.645 430.645 0 960 0Zm0 112.941c-467.125 0-847.059 379.934-847.059 847.059 0 467.12 379.934 847.06 847.059 847.06 467.12 0 847.06-379.94 847.06-847.06 0-467.125-379.94-847.059-847.06-847.059Zm0 313.726c294.55 0 533.33 238.781 533.33 533.333 0 294.55-238.78 533.33-533.33 533.33-294.552 0-533.333-238.78-533.333-533.33 0-294.552 238.781-533.333 533.333-533.333Z" fillRule="evenodd" />
                                    </svg>
                                </div>
                        }
                        {/* share my current screen button */}
                        {
                            isCurrentScreenOff
                                ?
                                <div className={styles['svg-box']} onClick={onShareMyCurrentScreen}>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                                        <path fillRule="evenodd" clipRule="evenodd" d="M2 12C2 7.28595 2 4.92893 3.46447 3.46447C4.92893 2 7.28595 2 12 2C16.714 2 19.0711 2 20.5355 3.46447C22 4.92893 22 7.28595 22 12C22 16.714 22 19.0711 20.5355 20.5355C19.0711 22 16.714 22 12 22C7.28595 22 4.92893 22 3.46447 20.5355C2 19.0711 2 16.714 2 12ZM12 17.75C12.4142 17.75 12.75 17.4142 12.75 17V11.8107L14.4697 13.5303C14.7626 13.8232 15.2374 13.8232 15.5303 13.5303C15.8232 13.2374 15.8232 12.7626 15.5303 12.4697L12.5303 9.46967C12.3897 9.32902 12.1989 9.25 12 9.25C11.8011 9.25 11.6103 9.32902 11.4697 9.46967L8.46967 12.4697C8.17678 12.7626 8.17678 13.2374 8.46967 13.5303C8.76256 13.8232 9.23744 13.8232 9.53033 13.5303L11.25 11.8107V17C11.25 17.4142 11.5858 17.75 12 17.75ZM8 7.75C7.58579 7.75 7.25 7.41421 7.25 7C7.25 6.58579 7.58579 6.25 8 6.25H16C16.4142 6.25 16.75 6.58579 16.75 7C16.75 7.41421 16.4142 7.75 16 7.75H8Z" fill="#1C274C" />
                                    </svg>
                                </div>
                                :
                                <div className={styles['screen-off-svg-box']} onClick={onShareMyCurrentScreen}>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                                        <path fillRule="evenodd" clipRule="evenodd" d="M2 12C2 7.28595 2 4.92893 3.46447 3.46447C4.92893 2 7.28595 2 12 2C16.714 2 19.0711 2 20.5355 3.46447C22 4.92893 22 7.28595 22 12C22 16.714 22 19.0711 20.5355 20.5355C19.0711 22 16.714 22 12 22C7.28595 22 4.92893 22 3.46447 20.5355C2 19.0711 2 16.714 2 12ZM12 17.75C12.4142 17.75 12.75 17.4142 12.75 17V11.8107L14.4697 13.5303C14.7626 13.8232 15.2374 13.8232 15.5303 13.5303C15.8232 13.2374 15.8232 12.7626 15.5303 12.4697L12.5303 9.46967C12.3897 9.32902 12.1989 9.25 12 9.25C11.8011 9.25 11.6103 9.32902 11.4697 9.46967L8.46967 12.4697C8.17678 12.7626 8.17678 13.2374 8.46967 13.5303C8.76256 13.8232 9.23744 13.8232 9.53033 13.5303L11.25 11.8107V17C11.25 17.4142 11.5858 17.75 12 17.75ZM8 7.75C7.58579 7.75 7.25 7.41421 7.25 7C7.25 6.58579 7.58579 6.25 8 6.25H16C16.4142 6.25 16.75 6.58579 16.75 7C16.75 7.41421 16.4142 7.75 16 7.75H8Z" fill="#ffffff" />
                                    </svg>
                                </div>
                        }

                        {/* disconnect streaming button */}
                        <div className={styles['svg-box']} onClick={onDisconnect}>
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M15 4V5C15 6.88562 15 7.82843 15.5858 8.41421C16.1716 9 17.1144 9 19 9H20.5M20.5 9L18 7M20.5 9L18 11" stroke="#1C274C" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" />
                                <path d="M15.5562 14.5477L15.1007 15.0272C15.1007 15.0272 14.0181 16.167 11.0631 13.0559C8.10812 9.94484 9.1907 8.80507 9.1907 8.80507L9.47752 8.50311C10.1841 7.75924 10.2507 6.56497 9.63424 5.6931L8.37326 3.90961C7.61028 2.8305 6.13596 2.68795 5.26145 3.60864L3.69185 5.26114C3.25823 5.71766 2.96765 6.30945 3.00289 6.96594C3.09304 8.64546 3.81071 12.259 7.81536 16.4752C12.0621 20.9462 16.0468 21.1239 17.6763 20.9631C18.1917 20.9122 18.6399 20.6343 19.0011 20.254L20.4217 18.7584C21.3806 17.7489 21.1102 16.0182 19.8833 15.312L17.9728 14.2123C17.1672 13.7486 16.1858 13.8848 15.5562 14.5477Z" fill="#1C274C" />
                            </svg>
                        </div>
                        {
                            browserWidth && (browserWidth < oneThousandTwentyFourWidth)
                            &&
                            <div className={styles['svg-box']}>
                                <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" version="1.1" viewBox="0 0 512 512" fill="#000000">
                                    <g strokeWidth="0" />
                                    <g strokeLinecap="round" strokeLinejoin="round" />
                                    <g>
                                        <g>
                                            <g>
                                                <g>
                                                    <polygon fill="#000000" points="316.83,170.68 237.913,170.416 249.881,95.058 328.798,95.322 " />
                                                    <polygon fill="#000000" points="232.722,203.101 232.702,203.227 195.081,203.101 183.113,278.459 220.734,278.585 198.803,416.677 277.72,416.942 311.639,203.366 " />
                                                </g>
                                                <g>
                                                    <path fill="#000000" d="M472.616,93.461c-7.258-10.355-15.488-20.179-24.693-29.384 c-9.116-9.116-18.852-17.347-29.118-24.427C382.341,13.807,339.15,0,293.836,0h-75.76C160.017,0,105.321,22.746,63.989,64.077 C22.746,105.321,0,160.017,0,218.076v75.849c0,47.704,15.4,93.107,43.721,130.721c6.107,8.143,12.922,15.931,20.267,23.277 c7.257,7.258,14.957,13.984,23.012,20.002C124.615,496.512,170.194,512,218.076,512h75.76 c58.059,0,112.755-22.746,154.087-64.077c41.244-41.243,63.989-95.939,63.989-153.998v-75.849 C511.912,172.938,498.193,129.836,472.616,93.461z M462.172,293.925c0,92.753-75.495,168.247-168.336,168.247h-75.76 c-92.841,0-168.336-75.494-168.336-168.247v-75.849c0-92.753,75.495-168.248,168.336-168.248h75.76 c92.841,0,168.336,75.494,168.336,168.248V293.925z" />
                                                </g>
                                            </g>
                                            <path fill="none" d="M49.775,218.096v75.808c0,92.788,75.489,168.277,168.278,168.277h37.903v-45.312l-57.153-0.192 l21.931-138.092l-37.62-0.126l11.969-75.358l37.62,0.126l0.02-0.126l23.234,0.078v-32.703l-18.043-0.061l11.968-75.358l6.075,0.021 V49.819h-37.903C125.264,49.819,49.775,125.307,49.775,218.096z" />
                                            <path fill="none" d="M328.798,95.322L316.83,170.68l-60.874-0.204v32.703l55.683,0.186L277.72,416.942l-21.764-0.073v45.312 h37.904c92.788,0,168.277-75.489,168.277-168.277v-75.808c0-92.788-75.488-168.277-168.277-168.277h-37.904v45.259L328.798,95.322z " />
                                            <g opacity="0.1">
                                                <polygon fill="#000000" points="328.798,95.322 255.956,95.078 255.956,170.476 316.83,170.68 " />
                                                <polygon fill="#000000" points="311.639,203.365 255.956,203.179 255.956,416.869 277.72,416.942 " />
                                                <path fill="#000000" d="M447.91,64.044C406.611,22.746,351.901,0.001,293.86,0.001h-37.904v49.818h37.904 c92.788,0,168.277,75.489,168.277,168.277v75.808c0,92.788-75.488,168.277-168.277,168.277h-37.904v49.818h37.904 c58.041,0,112.751-22.745,154.05-64.044c41.299-41.3,64.044-96.01,64.044-154.051v-75.808 C511.954,160.055,489.209,105.345,447.91,64.044z" />
                                            </g>
                                        </g>
                                    </g>
                                </svg>
                            </div>
                        }
                    </div>
                    {/* right setting bar */}
                    <div className={styles['right-setting-bar']}>
                        <div className={styles['svg-box']}>
                            <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" version="1.1" viewBox="0 0 512 512" fill="#000000">
                                <g strokeWidth="0" />
                                <g strokeLinecap="round" strokeLinejoin="round" />
                                <g>
                                    <g>
                                        <g>
                                            <g>
                                                <polygon fill="#000000" points="316.83,170.68 237.913,170.416 249.881,95.058 328.798,95.322 " />
                                                <polygon fill="#000000" points="232.722,203.101 232.702,203.227 195.081,203.101 183.113,278.459 220.734,278.585 198.803,416.677 277.72,416.942 311.639,203.366 " />
                                            </g>
                                            <g>
                                                <path fill="#000000" d="M472.616,93.461c-7.258-10.355-15.488-20.179-24.693-29.384 c-9.116-9.116-18.852-17.347-29.118-24.427C382.341,13.807,339.15,0,293.836,0h-75.76C160.017,0,105.321,22.746,63.989,64.077 C22.746,105.321,0,160.017,0,218.076v75.849c0,47.704,15.4,93.107,43.721,130.721c6.107,8.143,12.922,15.931,20.267,23.277 c7.257,7.258,14.957,13.984,23.012,20.002C124.615,496.512,170.194,512,218.076,512h75.76 c58.059,0,112.755-22.746,154.087-64.077c41.244-41.243,63.989-95.939,63.989-153.998v-75.849 C511.912,172.938,498.193,129.836,472.616,93.461z M462.172,293.925c0,92.753-75.495,168.247-168.336,168.247h-75.76 c-92.841,0-168.336-75.494-168.336-168.247v-75.849c0-92.753,75.495-168.248,168.336-168.248h75.76 c92.841,0,168.336,75.494,168.336,168.248V293.925z" />
                                            </g>
                                        </g>
                                        <path fill="none" d="M49.775,218.096v75.808c0,92.788,75.489,168.277,168.278,168.277h37.903v-45.312l-57.153-0.192 l21.931-138.092l-37.62-0.126l11.969-75.358l37.62,0.126l0.02-0.126l23.234,0.078v-32.703l-18.043-0.061l11.968-75.358l6.075,0.021 V49.819h-37.903C125.264,49.819,49.775,125.307,49.775,218.096z" />
                                        <path fill="none" d="M328.798,95.322L316.83,170.68l-60.874-0.204v32.703l55.683,0.186L277.72,416.942l-21.764-0.073v45.312 h37.904c92.788,0,168.277-75.489,168.277-168.277v-75.808c0-92.788-75.488-168.277-168.277-168.277h-37.904v45.259L328.798,95.322z " />
                                        <g opacity="0.1">
                                            <polygon fill="#000000" points="328.798,95.322 255.956,95.078 255.956,170.476 316.83,170.68 " />
                                            <polygon fill="#000000" points="311.639,203.365 255.956,203.179 255.956,416.869 277.72,416.942 " />
                                            <path fill="#000000" d="M447.91,64.044C406.611,22.746,351.901,0.001,293.86,0.001h-37.904v49.818h37.904 c92.788,0,168.277,75.489,168.277,168.277v75.808c0,92.788-75.488,168.277-168.277,168.277h-37.904v49.818h37.904 c58.041,0,112.751-22.745,154.05-64.044c41.299-41.3,64.044-96.01,64.044-154.051v-75.808 C511.954,160.055,489.209,105.345,447.91,64.044z" />
                                        </g>
                                    </g>
                                </g>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    )
}

export default Setting;